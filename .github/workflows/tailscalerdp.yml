name: Tailscale RDP Automation

on:
  push:
    branches:
      - main

jobs:
  setup-rdp:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Install Tailscale and RDP Tools
        run: |
          sudo apt update
          sudo apt install -y xrdp
          sudo apt install -y rdesktop  # Optional: Install RDP client on Linux for testing

      - name: Start Tailscale
        run: |
          sudo tailscale up --authkey <your-tailscale-authkey>  # Replace with your actual authkey

      - name: Get Tailscale IP Address
        run: |
          TAILSCALE_IP=$(tailscale ip -4)
          echo "Tailscale IP: $TAILSCALE_IP"

      - name: Verify RDP Accessibility
        run: |
          # Verify the RDP server is reachable
          nc -zv $TAILSCALE_IP 3389  # Default RDP port is 3389

      - name: Connect to RDP Session
        run: |
          # Use rdesktop or another RDP client to connect
          rdesktop $TAILSCALE_IP:3389 -u TechieRDP -p i22TQuy8iFLamNK02D6B
